<!DOCTYPE html>
<html>
<head>
    <title>My Appointments</title>
</head>
<body style="margin: 0;padding:0;">

{% include "accounts/provider_header.html" %}

{% if request.GET.clash %}
<script>
alert("❌ Cannot approve this appointment. Time slot clashes.");
</script>
{% endif %}

{% if request.GET.approved %}
<script>
alert("✔ Appointment approved successfully!");
</script>
{% endif %}

<div style="padding:25px; font-family:Arial;">

<h2>Upcoming Appointments</h2>

{% if upcoming %}
<table border="1" cellpadding="10">
    <tr>
        <th>Patient Name</th>
        <th>Date</th>
        <th>Time</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>

    {% for appt in upcoming %}
    <tr>
        <td>{{ appt.patient.first_name }} {{ appt.patient.last_name }}</td>
        <td>{{ appt.date }}</td>
        <td>{{ appt.start_time }} → {{ appt.end_time }}</td>
        <td>{{ appt.reason }}</td>
        <td>{{ appt.status }}</td>

        <td>
            {% if appt.status == "pending" %}
                <a href="{% url 'approve_appointment' appt.id %}">Approve</a> |
                <a href="{% url 'reject_appointment' appt.id %}">Reject</a>
            
            {% elif appt.status == "reschedule_requested" %}
                <a href="{% url 'approve_appointment' appt.id %}">Approve Reschedule</a> |
                <a href="{% url 'reject_appointment' appt.id %}">Reject</a>
            {% else %}
                -
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No upcoming appointments.</p>
{% endif %}

<br><br>

<h2>Completed Appointments</h2>

{% if completed %}
<table border="1" cellpadding="10">
    <tr>
        <th>Patient Name</th>
        <th>Date</th>
        <th>Time</th>
        <th>Reason</th>
        <th>Status</th>
    </tr>

    {% for appt in completed %}
    <tr>
        <td>{{ appt.patient.first_name }} {{ appt.patient.last_name }}</td>
        <td>{{ appt.date }}</td>
        <td>{{ appt.start_time }} → {{ appt.end_time }}</td>
        <td>{{ appt.reason }}</td>
        <td>{{ appt.status }}</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No completed appointments.</p>
{% endif %}

</div>

</body>
</html>
